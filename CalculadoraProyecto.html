<!DOCTYPE html>
<!-- Programa por José González y Emanuel Santizo -->
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Cálculo Diferencial e Integral</title>
    <!-- Carga de Tailwind CSS para un diseño moderno y responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuración de fuente Inter -->
    <style>
        /* CSS plano (sin @apply) para asegurar que los estilos se apliquen correctamente con el CDN */
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* === Estilos de Botones del Teclado (Fondo Suave y Borde de Color) === */
        
        /* Base para todos los botones del teclado */
        .tecla-base {
            padding: 0.75rem; /* p-3 */
            font-size: 1rem; /* Reducido a text-base (1rem) para acomodar sen(x) */
            font-weight: 700; /* font-bold */
            border-radius: 10px; /* Borde redondeado consistente */
            transition: all 0.15s ease-in-out;
            border-width: 2px; /* Grosor de borde consistente */
            border-style: solid;
            /* Por defecto centrado (funciona bien para números y operadores) */
            text-align: center; 
        }

        /* Estilo para Botones de Funciones (sin, cos, log, x, pi, e) */
        .btn-func {
            border-color: #4f46e5;      /* Indigo-600 */
            background-color: #eef2ff;      /* Indigo-50 */
            color: #3730a3;                 /* Indigo-800 */
            /* CAMBIO: Alineación a la izquierda para acomodar el texto largo */
            text-align: left; 
            padding-left: 0.5rem; /* Pequeño ajuste de padding izquierdo */
        }
        .btn-func:hover { background-color: #e0e7ff; } /* Indigo-100 */
        .btn-func:active { background-color: #c7d2fe; } /* Indigo-200 */

        /* Estilo para Botones de Operadores (+, -, *, /, ^, (, )) */
        .btn-op {
            border-color: #9ca3af;      /* Gray-400 */
            background-color: #f3f4f6;      /* Gray-100 */
            color: #1f2937;                 /* Gray-800 */
        }
        .btn-op:hover { background-color: #e5e7eb; } /* Gray-200 */
        .btn-op:active { background-color: #d1d5db; } /* Gray-300 */

        /* Estilo para Botones de Números (0-9, .) */
        .btn-num {
            border-color: #f59e0b;      /* Amber-500 */
            background-color: #fffbeb;      /* Amber-50 */
            color: #92400e;                 /* Amber-800 */
        }
        .btn-num:hover { background-color: #fef3c7; } /* Amber-100 */
        .btn-num:active { background-color: #fde68a; } /* Amber-200 */

        /* Estilo para el Botón Borrar Todo */
        .btn-clear {
            border-color: #ef4444;      /* Red-500 */
            background-color: #fef2f2;      /* Red-50 */
            color: #b91c1c;                 /* Red-700 */
        }
        .btn-clear:hover { background-color: #fee2e2; } /* Red-100 */
        .btn-clear:active { background-color: #fecaca; } /* Red-200 */

        /* Ajuste de Grid para espaciado y uniformidad */
        .grid-teclado {
             gap: 0.5rem; /* Espaciado uniforme de 8px */
        }
        .grid-teclado button {
             width: 100%;
             height: 100%; /* Asegura que la altura se respete en el grid */
        }
        /* Garantiza que todos los botones (excepto Borrar Todo) son cuadrados */
        .grid-teclado button:not(.btn-clear) {
             aspect-ratio: 1 / 1; 
        }
        
        /* Estilo para separar visualmente las áreas de cálculo */
        .calculation-section {
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            background-color: #f9fafb;
            margin-bottom: 1.5rem;
        }
    </style>
    <!-- Carga de Math.js para la manipulación y cálculo simbólico (Derivadas y Numérico) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.4.0/math.js"></script>
</head>
<body class="p-4 sm:p-8 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-lg bg-white p-6 sm:p-8 rounded-xl card">
        <h1 class="text-3xl font-bold text-gray-800 mb-4 text-center">Calculadora de Funciones</h1>
        
        <!-- Sección de Créditos visible -->
        <div class="mb-6 p-3 bg-indigo-50 border-l-4 border-indigo-400 rounded-md text-sm text-gray-700">
            <h3 class="font-semibold text-indigo-700 mb-1">Créditos de Desarrollo:</h3>
	       <p>José Daniel González Monroy: 5390-24-19904</p>
            <p>Ernesto Emanuel Santizo Santizo: 1990-24-1077</p>
            
        </div>
        
        <p class="text-gray-600 mb-6 text-center">Introduce la función y selecciona el cálculo deseado.</p>

        <!-- Contenedor de la función a ingresar -->
        <div class="mb-4">
            <label for="entradaFuncion" class="block text-sm font-medium text-gray-700 mb-1">
                Función f(x)
            </label>
            <input type="text" id="entradaFuncion" placeholder="Ej: exp(-x^2) * sen(x) + ln(x)"
                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150 text-right">

            <!-- Ejemplos de formato -->
            <div class="mt-1 text-xs text-gray-400 p-1 border-b border-gray-100">
                <p><strong>Ejemplo Derivada:</strong> <code class="bg-gray-50 p-0.5 rounded">x^3 + cos(2*x)</code></p>
                <p><strong>Ejemplo Integral:</strong> <code class="bg-gray-50 p-0.5 rounded">1 / x</code></p>
            </div>
            <!-- Fin de Ejemplos -->
        </div>
        
        <!-- Contenedor de la variable -->
        <div class="mb-6 flex flex-col items-center">
            <label for="entradaVariable" class="block text-sm font-medium text-gray-700 mb-1">
                Variable de Cálculo
            </label>
            <!-- Ajuste del tamaño del texto a text-xl -->
            <input type="text" id="entradaVariable" value="x"
                   class="w-14 h-14 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-center text-xl font-semibold">
        </div>

        <!-- Teclado de Entrada Rápida -->
        <div class="mb-6 border-t pt-4">
            <h3 class="text-sm font-medium text-gray-700 mb-2">Teclado Rápido:</h3>
            <!-- Se agregó la clase grid-teclado para el espaciado uniforme -->
            <div class="grid grid-cols-5 sm:grid-cols-7 grid-teclado">
                
                <!-- Fila 1: Funciones Trigonométricas y Borrar -->
                <button class="tecla-base btn-func" onclick="insertarTexto('sin(')">sen(x)</button>
                <button class="tecla-base btn-func" onclick="insertarTexto('cos(')">cos(x)</button>
                <button class="tecla-base btn-func" onclick="insertarTexto('tan(')">tan(x)</button>
                <button class="tecla-base btn-func" onclick="insertarTexto('log(')">ln(x)</button>
                <button class="tecla-base btn-func" onclick="insertarTexto('exp(')">e^x</button>
                <button class="tecla-base btn-clear col-span-2" onclick="limpiarEntrada()">Borrar Todo (C)</button>

                <!-- Fila 2: Números 7, 8, 9 y Operadores -->
                <button class="tecla-base btn-num" onclick="insertarTexto('7')">7</button>
                <button class="tecla-base btn-num" onclick="insertarTexto('8')">8</button>
                <button class="tecla-base btn-num" onclick="insertarTexto('9')">9</button>
                <button class="tecla-base btn-op" onclick="insertarTexto('/')">/</button>
                <button class="tecla-base btn-op" onclick="insertarTexto('*')">*</button>
                <button class="tecla-base btn-op" onclick="insertarTexto('(')">(</button>
                <button class="tecla-base btn-op" onclick="insertarTexto(')')">)</button>


                <!-- Fila 3: Números 4, 5, 6 y Operadores -->
                <button class="tecla-base btn-num" onclick="insertarTexto('4')">4</button>
                <button class="tecla-base btn-num" onclick="insertarTexto('5')">5</button>
                <button class="tecla-base btn-num" onclick="insertarTexto('6')">6</button>
                <button class="tecla-base btn-op" onclick="insertarTexto('-')">-</button>
                <button class="tecla-base btn-op" onclick="insertarTexto('+')">+</button>
                <button class="tecla-base btn-op" onclick="insertarTexto('^')">^</button>
                <button class="tecla-base btn-op" onclick="insertarTexto('.')">.</button>
                
                <!-- Fila 4: Números 1, 2, 3 y Constantes/Variables -->
                <button class="tecla-base btn-num" onclick="insertarTexto('1')">1</button>
                <button class="tecla-base btn-num" onclick="insertarTexto('2')">2</button>
                <button class="tecla-base btn-num" onclick="insertarTexto('3')">3</button>
                
                <button class="tecla-base btn-func col-start-4" onclick="insertarTexto('pi')">π</button>
                <button class="tecla-base btn-func" onclick="insertarTexto('e')">e</button>
                <button class="tecla-base btn-func" onclick="insertarTexto('x')">x</button>
                <div class="tecla-base btn-num bg-transparent border-transparent"></div> <!-- Espacio vacío -->
                
                <!-- Fila 5: Número 0 -->
                <div class="tecla-base btn-num bg-transparent border-transparent"></div> <!-- Espacio vacío -->
                <button class="tecla-base btn-num" onclick="insertarTexto('0')">0</button>
                <div class="tecla-base btn-num bg-transparent border-transparent"></div> <!-- Espacio vacío -->

            </div>
        </div>

        <!-- Sección de Derivada -->
        <div class="calculation-section border-indigo-300">
            <h2 class="text-lg font-bold text-indigo-700 mb-3">Cálculo de Derivada (Simbólica)</h2>
            <button onclick="calcularDerivada()"
                    class="w-full px-4 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-150 ease-in-out transform hover:scale-[1.01] text-sm sm:text-base">
                Derivar Función
            </button>
        </div>

        <!-- Sección de Integral Definida -->
        <div class="calculation-section border-green-300">
            <h2 class="text-lg font-bold text-green-700 mb-3">Cálculo de Integral (Numérica)</h2>
            
            <!-- Contenedor de los límites de integración -->
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="limiteInferior" class="block text-sm font-medium text-gray-700 mb-1">
                        Primer Límite (a)
                    </label>
                    <input type="number" id="limiteInferior" placeholder="Límite Inferior" value="0"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 text-center">
                </div>
                <div>
                    <label for="limiteSuperior" class="block text-sm font-medium text-gray-700 mb-1">
                        Segundo Límite (b)
                    </label>
                    <input type="number" id="limiteSuperior" placeholder="Límite Superior" value="1"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 text-center">
                </div>
            </div>

            <button onclick="calcularIntegralDefinida()"
                    class="w-full px-4 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-150 ease-in-out transform hover:scale-[1.01] text-sm sm:text-base">
                Calcular Integral Definida
            </button>
        </div>

        <!-- Área de resultados -->
        <div class="bg-gray-100 p-4 rounded-lg border border-gray-200 mt-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-2">Resultado:</h2>
            <p id="areaResultado" class="text-gray-900 break-words min-h-[40px] flex items-center">
                Esperando cálculo...
            </p>
        </div>
        
        <!-- Mensaje de advertencia para la integral -->
        <div id="mensajeIntegral" class="mt-4 p-3 bg-yellow-100 border border-yellow-200 text-yellow-700 rounded-lg hidden">
            <strong>Nota sobre la Integral:</strong> El resultado de la integral definida es una <strong>aproximación numérica</strong> basada en $10,000$ pasos (Regla del Trapecio).
        </div>
    </div>

    <script>
        // Variables globales y configuración
        const campoFuncion = document.getElementById('entradaFuncion');
        const campoVariable = document.getElementById('entradaVariable');
        const campoLimiteInferior = document.getElementById('limiteInferior');
        const campoLimiteSuperior = document.getElementById('limiteSuperior');
        const areaResultado = document.getElementById('areaResultado');
        const mensajeIntegral = document.getElementById('mensajeIntegral');
        const N_PASOS_INTEGRAL = 10000; // Número de subintervalos para la regla del trapecio

        /**
         * Maneja la inserción de texto en el campo de la función
         * en la posición actual del cursor.
         * @param {string} texto El texto o símbolo a insertar.
         */
        function insertarTexto(texto) {
            const inicio = campoFuncion.selectionStart;
            const fin = campoFuncion.selectionEnd;
            const valor = campoFuncion.value;

            // Inserta el texto en la posición del cursor
            campoFuncion.value = valor.substring(0, inicio) + texto + valor.substring(fin);
            
            // Mueve el cursor al final del texto insertado
            let nuevaPosicion = inicio + texto.length;
            
            // Si insertamos una función como 'sin(', movemos el cursor dentro del paréntesis
            if (texto.endsWith('(')) {
                nuevaPosicion -= 1;
            }
            
            campoFuncion.selectionStart = nuevaPosicion;
            campoFuncion.selectionEnd = nuevaPosicion;
            campoFuncion.focus(); // Devuelve el foco al campo de texto
        }
        
        /**
         * Limpia el campo de entrada de la función.
         */
        function limpiarEntrada() {
            campoFuncion.value = '';
            campoFuncion.focus();
        }


        /**
         * Muestra un mensaje de error o el resultado en el área designada.
         * @param {string} mensaje El mensaje a mostrar.
         * @param {boolean} esError Si es true, el mensaje se muestra como un error.
         */
        function mostrarResultado(mensaje, esError = false) {
            areaResultado.textContent = mensaje;
            areaResultado.classList.toggle('text-red-600', esError);
            areaResultado.classList.toggle('text-gray-900', !esError);
            mensajeIntegral.classList.add('hidden'); // Ocultar nota de integral por defecto
        }


        /**
         * Realiza sustituciones comunes en español y limpieza de la expresión
         * para que Math.js pueda procesarla correctamente.
         * @param {string} expresion La cadena de la función de entrada.
         * @returns {string} La expresión procesada.
         */
        function preprocesarExpresion(expresion) {
            let limpia = expresion.trim();

            // 1. Reemplazar 'sen' por 'sin' 
            limpia = limpia.replace(/sen/gi, 'sin'); 

            // 2. Reemplazar 'ln' por 'log' 
            limpia = limpia.replace(/ln/gi, 'log');

            // 3. Eliminar posibles diferenciales 'dx', 'dy', etc. 
            limpia = limpia.replace(/(\s*d[a-z]\s*)$/i, '');
            
            return limpia;
        }

        /**
         * Intenta compilar la expresión de la función usando Math.js (utilizada para el cálculo numérico).
         * @param {string} expresion La cadena de la función.
         * @returns {math.EvalFunction|null} La función compilada o null en caso de error.
         */
        function compilarFuncion(expresion) {
            try {
                return math.compile(expresion);
            } catch (e) {
                mostrarResultado(`Error de sintaxis: Revise la función. (Detalles: ${e.message})`, true);
                return null;
            }
        }

        /**
         * Calcula la derivada simbólica de la función ingresada (utiliza Math.js).
         */
        function calcularDerivada() {
            let expresion = campoFuncion.value;
            const variable = campoVariable.value.trim() || 'x';

            if (!expresion) {
                mostrarResultado("Por favor, introduce una función.", true);
                return;
            }
            
            // Preprocesamiento
            expresion = preprocesarExpresion(expresion); 

            try {
                // math.derivative se utiliza para el cálculo simbólico
                const derivadaNodo = math.derivative(expresion, variable);
                
                // Formatear la salida para que sea legible y simplificada
                const resultado = derivadaNodo.toString({
                    parenthesis: 'auto',
                    implicit: 'hide' // Oculta multiplicaciones innecesarias como '1 * x'
                });
                
                // Limpieza de expresiones redundantes de Math.js
                let resultadoLimpio = resultado.replace(/1 \* /g, '');
                
                mostrarResultado(`d/d${variable} [${expresion}] = ${resultadoLimpio}`);

            } catch (e) {
                mostrarResultado(`Error al derivar: Asegúrate de que la función sea válida y la variable correcta. (Detalles: ${e.message})`, true);
            }
        }

        /**
         * Calcula la integral definida (valor numérico) usando la Regla del Trapecio (utiliza Math.js).
         */
        function calcularIntegralDefinida() {
            let expresion = campoFuncion.value;
            const variable = campoVariable.value.trim() || 'x';
            
            // Obtener límites y parsear a números
            const a = parseFloat(campoLimiteInferior.value);
            const b = parseFloat(campoLimiteSuperior.value);

            if (!expresion || isNaN(a) || isNaN(b)) {
                mostrarResultado("Por favor, introduce la función y límites válidos.", true);
                return;
            }

            // Preprocesamiento
            expresion = preprocesarExpresion(expresion); 

            // 1. Compilar la función
            const fCompilada = compilarFuncion(expresion);
            if (!fCompilada) return;

            // 2. Definir los parámetros para la Regla del Trapecio
            const n = N_PASOS_INTEGRAL;
            const h = (b - a) / n; // Ancho de cada subintervalo

            // Manejar caso donde el límite superior es menor que el inferior (inversión de límites)
            const factorSigno = a > b ? -1 : 1;
            const inicio = Math.min(a, b);
            const fin = Math.max(a, b);

            let integralAprox = 0;

            try {
                // Función para evaluar f(x)
                const evaluarF = (x) => {
                    // Crea el scope para la evaluación con la variable ingresada
                    const scope = { [variable]: x }; 
                    return fCompilada.evaluate(scope);
                };

                // Regla del Trapecio (aproximación)
                
                // Primer y último término (f(a) + f(b))
                integralAprox += (evaluarF(inicio) + evaluarF(fin)) / 2;

                // Suma de los términos intermedios
                for (let i = 1; i < n; i++) {
                    const x_i = inicio + i * h;
                    integralAprox += evaluarF(x_i);
                }
                
                // Multiplicar por el ancho h
                integralAprox *= h;
                
                // Aplicar el factor de signo si los límites se invirtieron
                integralAprox *= factorSigno;

                mostrarResultado(`El valor de la integral definida de ${expresion} entre ${a} y ${b} es ≈ ${integralAprox.toFixed(8)}`);
                mensajeIntegral.classList.remove('hidden'); // Mostrar nota de integral

            } catch (e) {
                mostrarResultado(`Error al integrar: Asegúrate de que la función no tenga singularidades en el intervalo. (Detalles: ${e.message})`, true);
            }
        }
    </script>

</body>
</html>

